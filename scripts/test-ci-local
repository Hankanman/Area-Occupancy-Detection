#!/bin/bash
"""Run tests exactly like CI does locally."""

set -e  # Exit on error

echo "🔍 Running CI-like tests locally..."

# Validate environment first
echo "Step 1: Validating environment..."
python scripts/validate-env || exit 1

echo ""
echo "Step 2: Installing exact CI dependencies..."
pip install -r requirements.txt
pip install -r requirements_test.txt

echo ""
echo "Step 3: Running linting (like CI)..."
python -m ruff check .
python -m ruff format . --check

echo ""
echo "Step 4: Running tests with CI flags..."
pytest \
  --cov=custom_components/area_occupancy \
  --cov-report=xml \
  --cov-report=term-missing \
  -W ignore::RuntimeWarning \
  --tb=short \
  -v

echo ""
echo "✅ All CI-like tests passed locally!"
echo "Your changes should pass in CI 🎉"