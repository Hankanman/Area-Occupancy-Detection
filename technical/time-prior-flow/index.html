<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation for the Home Assistant Area Occupancy Detection integration"><meta name=author content=Hankanman><link href=https://hankanman.github.io/Area-Occupancy-Detection/technical/time-prior-flow/ rel=canonical><link href=../global-prior-flow/ rel=prev><link href=../entity-evidence/ rel=next><link rel=icon href=https://brands.home-assistant.io/area_occupancy/dark_icon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.2"><title>Time Prior Flow - Area Occupancy Detection</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#time-prior-feature-complete-code-flow-documentation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Area Occupancy Detection" class="md-header__button md-logo" aria-label="Area Occupancy Detection" data-md-component=logo> <img src=https://brands.home-assistant.io/area_occupancy/dark_icon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Area Occupancy Detection </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Time Prior Flow </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=cyan aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=cyan aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/Hankanman/Area-Occupancy-Detection title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Hankanman/Area-Occupancy-Detection </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/installation/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../features/purpose/ class=md-tabs__link> Features </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../deep-dive/ class=md-tabs__link> Technical </a> </li> <li class=md-tabs__item> <a href=../../simulator/ class=md-tabs__link> Simulator </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Area Occupancy Detection" class="md-nav__button md-logo" aria-label="Area Occupancy Detection" data-md-component=logo> <img src=https://brands.home-assistant.io/area_occupancy/dark_icon.png alt=logo> </a> Area Occupancy Detection </label> <div class=md-nav__source> <a href=https://github.com/Hankanman/Area-Occupancy-Detection title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Hankanman/Area-Occupancy-Detection </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/why/ class=md-nav__link> <span class=md-ellipsis> Why AOD </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/basic-usage/ class=md-nav__link> <span class=md-ellipsis> Basic Usage </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../features/purpose/ class=md-nav__link> <span class=md-ellipsis> Purpose </span> </a> </li> <li class=md-nav__item> <a href=../../features/sensors/ class=md-nav__link> <span class=md-ellipsis> Sensors </span> </a> </li> <li class=md-nav__item> <a href=../../features/calculation/ class=md-nav__link> <span class=md-ellipsis> Bayesian Calculation </span> </a> </li> <li class=md-nav__item> <a href=../../features/prior-learning/ class=md-nav__link> <span class=md-ellipsis> Prior Learning </span> </a> </li> <li class=md-nav__item> <a href=../../features/likelihood/ class=md-nav__link> <span class=md-ellipsis> Sensor Likelihoods </span> </a> </li> <li class=md-nav__item> <a href=../../features/sensor-correlation/ class=md-nav__link> <span class=md-ellipsis> Sensor Correlation </span> </a> </li> <li class=md-nav__item> <a href=../../features/wasp-in-box/ class=md-nav__link> <span class=md-ellipsis> Wasp in Box </span> </a> </li> <li class=md-nav__item> <a href=../../features/sleep-presence/ class=md-nav__link> <span class=md-ellipsis> Sleep Presence </span> </a> </li> <li class=md-nav__item> <a href=../../features/activity-detection/ class=md-nav__link> <span class=md-ellipsis> Activity Detection </span> </a> </li> <li class=md-nav__item> <a href=../../features/decay/ class=md-nav__link> <span class=md-ellipsis> Decay </span> </a> </li> <li class=md-nav__item> <a href=../../features/entities/ class=md-nav__link> <span class=md-ellipsis> Entities </span> </a> </li> <li class=md-nav__item> <a href=../../features/services/ class=md-nav__link> <span class=md-ellipsis> Services </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Technical </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Technical </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../deep-dive/ class=md-nav__link> <span class=md-ellipsis> Deep Dive </span> </a> </li> <li class=md-nav__item> <a href=../analysis-chain/ class=md-nav__link> <span class=md-ellipsis> Analysis Chain </span> </a> </li> <li class=md-nav__item> <a href=../bayesian-calculation/ class=md-nav__link> <span class=md-ellipsis> Bayesian Calculation </span> </a> </li> <li class=md-nav__item> <a href=../calculation-flow/ class=md-nav__link> <span class=md-ellipsis> Calculation Flow </span> </a> </li> <li class=md-nav__item> <a href=../data-flow/ class=md-nav__link> <span class=md-ellipsis> Data Flow </span> </a> </li> <li class=md-nav__item> <a href=../global-prior-flow/ class=md-nav__link> <span class=md-ellipsis> Global Prior Flow </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Time Prior Flow </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Time Prior Flow </span> </a> <nav class="md-nav md-nav--secondary" aria-label="On this page"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> On this page </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#data-sources-and-input-flow class=md-nav__link> <span class=md-ellipsis> Data Sources and Input Flow </span> </a> <nav class=md-nav aria-label="Data Sources and Input Flow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-historical-data-collection class=md-nav__link> <span class=md-ellipsis> 1.1 Historical Data Collection </span> </a> </li> <li class=md-nav__item> <a href=#12-occupied-intervals-calculation class=md-nav__link> <span class=md-ellipsis> 1.2 Occupied Intervals Calculation </span> </a> </li> <li class=md-nav__item> <a href=#13-caching-layer class=md-nav__link> <span class=md-ellipsis> 1.3 Caching Layer </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#time-prior-calculation class=md-nav__link> <span class=md-ellipsis> Time Prior Calculation </span> </a> <nav class=md-nav aria-label="Time Prior Calculation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-implementation-overview class=md-nav__link> <span class=md-ellipsis> 2.1 Implementation Overview </span> </a> </li> <li class=md-nav__item> <a href=#22-calculation-process class=md-nav__link> <span class=md-ellipsis> 2.2 Calculation Process </span> </a> </li> <li class=md-nav__item> <a href=#23-integration-point class=md-nav__link> <span class=md-ellipsis> 2.3 Integration Point </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#storage-mechanism class=md-nav__link> <span class=md-ellipsis> Storage Mechanism </span> </a> <nav class=md-nav aria-label="Storage Mechanism"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-database-schema class=md-nav__link> <span class=md-ellipsis> 3.1 Database Schema </span> </a> </li> <li class=md-nav__item> <a href=#32-storage-operations class=md-nav__link> <span class=md-ellipsis> 3.2 Storage Operations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#retrieval-at-runtime class=md-nav__link> <span class=md-ellipsis> Retrieval at Runtime </span> </a> <nav class=md-nav aria-label="Retrieval at Runtime"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-retrieval-flow class=md-nav__link> <span class=md-ellipsis> 4.1 Retrieval Flow </span> </a> </li> <li class=md-nav__item> <a href=#42-time-slot-calculation class=md-nav__link> <span class=md-ellipsis> 4.2 Time Slot Calculation </span> </a> </li> <li class=md-nav__item> <a href=#43-caching-strategy class=md-nav__link> <span class=md-ellipsis> 4.3 Caching Strategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage-in-probability-calculation class=md-nav__link> <span class=md-ellipsis> Usage in Probability Calculation </span> </a> <nav class=md-nav aria-label="Usage in Probability Calculation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-prior-combination class=md-nav__link> <span class=md-ellipsis> 5.1 Prior Combination </span> </a> </li> <li class=md-nav__item> <a href=#52-integration-point class=md-nav__link> <span class=md-ellipsis> 5.2 Integration Point </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#code-flow-diagrams class=md-nav__link> <span class=md-ellipsis> Code Flow Diagrams </span> </a> <nav class=md-nav aria-label="Code Flow Diagrams"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-time-prior-retrieval-sequence class=md-nav__link> <span class=md-ellipsis> 6.1 Time Prior Retrieval Sequence </span> </a> </li> <li class=md-nav__item> <a href=#62-time-prior-calculation-flow-when-implemented class=md-nav__link> <span class=md-ellipsis> 6.2 Time Prior Calculation Flow (When Implemented) </span> </a> </li> <li class=md-nav__item> <a href=#63-complete-prior-calculation-flow class=md-nav__link> <span class=md-ellipsis> 6.3 Complete Prior Calculation Flow </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#implementation-notes class=md-nav__link> <span class=md-ellipsis> Implementation Notes </span> </a> <nav class=md-nav aria-label="Implementation Notes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-cache-invalidation-logic class=md-nav__link> <span class=md-ellipsis> 7.1 Cache Invalidation Logic </span> </a> </li> <li class=md-nav__item> <a href=#73-default-value-handling class=md-nav__link> <span class=md-ellipsis> 7.3 Default Value Handling </span> </a> </li> <li class=md-nav__item> <a href=#74-time-slot-granularity class=md-nav__link> <span class=md-ellipsis> 7.4 Time Slot Granularity </span> </a> </li> <li class=md-nav__item> <a href=#75-data-period-tracking class=md-nav__link> <span class=md-ellipsis> 7.5 Data Period Tracking </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#related-documentation class=md-nav__link> <span class=md-ellipsis> Related Documentation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../entity-evidence/ class=md-nav__link> <span class=md-ellipsis> Entity Evidence </span> </a> </li> <li class=md-nav__item> <a href=../likelihood-calculation/ class=md-nav__link> <span class=md-ellipsis> Likelihood Calculation </span> </a> </li> <li class=md-nav__item> <a href=../database-schema/ class=md-nav__link> <span class=md-ellipsis> Database Schema </span> </a> </li> <li class=md-nav__item> <a href=../prerelease/ class=md-nav__link> <span class=md-ellipsis> Pre-Releases </span> </a> </li> <li class=md-nav__item> <a href=../debug/ class=md-nav__link> <span class=md-ellipsis> Debugging </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../simulator/ class=md-nav__link> <span class=md-ellipsis> Simulator </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/Hankanman/Area-Occupancy-Detection/edit/main/docs/docs/technical/time-prior-flow.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/Hankanman/Area-Occupancy-Detection/raw/main/docs/docs/technical/time-prior-flow.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=time-prior-feature-complete-code-flow-documentation>Time Prior Feature - Complete Code Flow Documentation<a class=headerlink href=#time-prior-feature-complete-code-flow-documentation title="Permanent link">&para;</a></h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>The time prior feature provides time-of-day and day-of-week specific occupancy probabilities. This document provides a comprehensive deep dive into how time priors work, including data sources, calculation, storage, retrieval, and usage in probability calculations.</p> <p><strong>Implementation Status</strong>: Time priors are <strong>fully implemented</strong>. The system calculates time priors from historical data during the analysis cycle and stores them in the database for efficient retrieval at runtime.</p> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ol> <li><a href=#data-sources-and-input-flow>Data Sources and Input Flow</a></li> <li><a href=#time-prior-calculation>Time Prior Calculation</a></li> <li><a href=#storage-mechanism>Storage Mechanism</a></li> <li><a href=#retrieval-at-runtime>Retrieval at Runtime</a></li> <li><a href=#usage-in-probability-calculation>Usage in Probability Calculation</a></li> <li><a href=#code-flow-diagrams>Code Flow Diagrams</a></li> <li><a href=#implementation-notes>Implementation Notes</a></li> </ol> <h2 id=data-sources-and-input-flow>Data Sources and Input Flow<a class=headerlink href=#data-sources-and-input-flow title="Permanent link">&para;</a></h2> <h3 id=11-historical-data-collection>1.1 Historical Data Collection<a class=headerlink href=#11-historical-data-collection title="Permanent link">&para;</a></h3> <p><strong>Source</strong>: Home Assistant Recorder database</p> <p><strong>Process</strong>: <code>sync_states()</code> in <code>db/sync.py</code> imports state history from Home Assistant's recorder</p> <p><strong>Storage</strong>: Raw intervals stored in <code>intervals</code> table with:</p> <ul> <li><code>entity_id</code>: The sensor entity ID</li> <li><code>state</code>: The sensor state (e.g., "on", "off")</li> <li><code>start_time</code>: When the state change occurred</li> <li><code>end_time</code>: When the next state change occurred</li> <li><code>duration_seconds</code>: Duration of this interval</li> <li><code>area_name</code>: The area this interval belongs to</li> </ul> <p><strong>Ground Truth</strong>: Motion sensors exclusively (see <code>queries.py:get_occupied_intervals()</code>)</p> <p>The system uses motion sensors as the "ground truth" for occupancy because they are the most direct indicator of human presence and rarely generate false positives.</p> <h3 id=12-occupied-intervals-calculation>1.2 Occupied Intervals Calculation<a class=headerlink href=#12-occupied-intervals-calculation title="Permanent link">&para;</a></h3> <p><strong>Location</strong>: <code>db/queries.py:get_occupied_intervals()</code></p> <p><strong>Method</strong>:</p> <ol> <li>Queries motion sensor intervals from <code>intervals</code> table filtered by:</li> <li><code>entry_id</code>: Integration entry ID</li> <li><code>area_name</code>: Specific area</li> <li><code>entity_type == InputType.MOTION.value</code>: Only motion sensors</li> <li><code>state == "on"</code>: Only active motion intervals</li> <li> <p><code>start_time &gt;= lookback_date</code>: Within lookback period</p> </li> <li> <p>Merges overlapping intervals using <code>utils.py:merge_overlapping_intervals()</code></p> </li> <li>Combines intervals that overlap or are adjacent</li> <li> <p>Prevents double-counting of occupied time</p> </li> <li> <p>Applies motion timeout extension using <code>utils.py:apply_motion_timeout()</code></p> </li> <li>Extends intervals by the motion timeout period (default: 5 minutes)</li> <li>Accounts for time after motion stops when area may still be occupied</li> </ol> <p><strong>Output</strong>: List of <code>(start_time, end_time)</code> tuples representing occupied periods</p> <p><strong>Example</strong>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>intervals</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=p>(</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>datetime</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>15</span><span class=p>)),</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    <span class=p>(</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>12</span><span class=p>),</span> <span class=n>datetime</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>30</span><span class=p>)),</span>  <span class=c1># Overlaps with first</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=p>(</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>datetime</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>5</span><span class=p>)),</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=p>]</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=c1># After merging and timeout extension:</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=n>merged</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=p>(</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>datetime</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>35</span><span class=p>)),</span>  <span class=c1># Merged + timeout</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>    <span class=p>(</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>datetime</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>10</span><span class=p>)),</span>  <span class=c1># Extended by timeout</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=p>]</span>
</span></code></pre></div> <h3 id=13-caching-layer>1.3 Caching Layer<a class=headerlink href=#13-caching-layer title="Permanent link">&para;</a></h3> <p><strong>Table</strong>: <code>occupied_intervals_cache</code> (see <code>schema.py:OccupiedIntervalsCache</code>)</p> <p><strong>Purpose</strong>: Precomputed occupied intervals to avoid recalculation</p> <p><strong>Population</strong>: <code>operations.py:save_occupied_intervals_cache()</code></p> <ul> <li>Called during analysis cycle</li> <li>Stores merged and extended intervals</li> <li>Includes <code>calculation_date</code> for cache validity checking</li> </ul> <p><strong>Validity Check</strong>: <code>queries.py:is_occupied_intervals_cache_valid()</code></p> <ul> <li>Checks if cache is less than 24 hours old (default)</li> <li>Returns <code>False</code> if cache is stale or missing</li> </ul> <p><strong>Usage</strong>: The cache is used by prior analysis to avoid recalculating occupied intervals from raw sensor data.</p> <h2 id=time-prior-calculation>Time Prior Calculation<a class=headerlink href=#time-prior-calculation title="Permanent link">&para;</a></h2> <h3 id=21-implementation-overview>2.1 Implementation Overview<a class=headerlink href=#21-implementation-overview title="Permanent link">&para;</a></h3> <p>Time priors are calculated during the analysis cycle by the <code>PriorAnalyzer</code> class. The calculation occurs automatically after global prior calculation, using the same occupied intervals data.</p> <p><strong>Location</strong>: <code>data/analysis.py:PriorAnalyzer.calculate_time_priors()</code></p> <p><strong>Grid</strong>: 168 time slots (24 hours × 7 days)</p> <ul> <li>Each slot represents one hour on a specific day of week</li> <li>Day of week: 0=Monday, 1=Tuesday, ..., 6=Sunday</li> <li>Time slot: 0=00:00-01:00, 1=01:00-02:00, ..., 23=23:00-24:00</li> </ul> <h3 id=22-calculation-process>2.2 Calculation Process<a class=headerlink href=#22-calculation-process title="Permanent link">&para;</a></h3> <p>The calculation follows these steps:</p> <ol> <li> <p><strong>Get Occupied Intervals</strong>: Uses the same occupied intervals calculated for global prior analysis (from motion sensors, merged and extended with motion timeout).</p> </li> <li> <p><strong>Process Each Interval</strong>: For each occupied interval:</p> </li> <li>Iterates through all time slots the interval overlaps with</li> <li>Calculates the overlap duration for each slot</li> <li> <p>Tracks which week each overlap belongs to (for data point counting)</p> </li> <li> <p><strong>Calculate Per-Slot Statistics</strong>:</p> </li> <li><strong>Occupied Seconds</strong>: Sum of all overlap durations for each slot</li> <li><strong>Data Points</strong>: Number of unique weeks with data for each slot</li> <li> <p><strong>Total Slot Seconds</strong>: <code>data_points × 3600</code> (seconds per hour)</p> </li> <li> <p><strong>Calculate Prior Values</strong>:</p> </li> <li>For each slot: <code>prior_value = occupied_seconds / total_slot_seconds</code></li> <li>Applies safety bounds: clamps to [0.1, 0.9] range</li> <li> <p>Only calculates priors for slots with data (missing slots default to 0.5 at retrieval)</p> </li> <li> <p><strong>Save to Database</strong>: Calls <code>save_time_priors()</code> to store all calculated priors with metadata:</p> </li> <li><code>prior_value</code>: The calculated probability</li> <li><code>data_points</code>: Number of weeks with data</li> <li><code>confidence</code>: Calculated as <code>min(1.0, data_points / 4.0)</code> (4 weeks = full confidence)</li> <li><code>sample_period_start/end</code>: The data period used</li> <li><code>calculation_method</code>: "interval_analysis"</li> </ol> <p><strong>Note</strong>: Only motion sensors are used for time prior calculation (no media/appliance fallback).</p> <p><strong>Safety Bounds</strong>: The system bounds time-specific probabilities between 10% and 90% to prevent extreme values from dominating the calculation.</p> <h3 id=23-integration-point>2.3 Integration Point<a class=headerlink href=#23-integration-point title="Permanent link">&para;</a></h3> <p><strong>Called From</strong>: <code>data/analysis.py:PriorAnalyzer.calculate_and_update_prior()</code> (line 303-337)</p> <p><strong>Timing</strong>: After global prior calculation completes successfully</p> <p><strong>Error Handling</strong>: If time prior calculation fails, it logs a warning but does not prevent global prior from being saved. The system continues to function using only the global prior until the next analysis cycle.</p> <h2 id=storage-mechanism>Storage Mechanism<a class=headerlink href=#storage-mechanism title="Permanent link">&para;</a></h2> <h3 id=31-database-schema>3.1 Database Schema<a class=headerlink href=#31-database-schema title="Permanent link">&para;</a></h3> <p><strong>Table</strong>: <code>priors</code> (see <code>schema.py:176-247</code>)</p> <p><strong>Primary Key</strong>: Composite of <code>(area_name, day_of_week, time_slot)</code></p> <ul> <li>Ensures one prior value per area per time slot</li> <li>Allows efficient lookup by area and time slot</li> </ul> <p><strong>Columns</strong>:</p> <table> <thead> <tr> <th>Column</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>entry_id</code></td> <td>String</td> <td>Integration entry ID (same for all priors)</td> </tr> <tr> <td><code>area_name</code></td> <td>String (PK, FK)</td> <td>Area name (foreign key to <code>areas</code> table)</td> </tr> <tr> <td><code>day_of_week</code></td> <td>Integer (PK)</td> <td>Day of week (0=Monday, 6=Sunday)</td> </tr> <tr> <td><code>time_slot</code></td> <td>Integer (PK)</td> <td>Time slot (0-23 for hourly slots)</td> </tr> <tr> <td><code>prior_value</code></td> <td>Float</td> <td>Prior probability for this slot (0.0-1.0)</td> </tr> <tr> <td><code>data_points</code></td> <td>Integer</td> <td>Number of data points used in calculation</td> </tr> <tr> <td><code>confidence</code></td> <td>Float</td> <td>Confidence in calculation (0.0-1.0, nullable)</td> </tr> <tr> <td><code>last_calculation_date</code></td> <td>DateTime</td> <td>When prior was last calculated (nullable)</td> </tr> <tr> <td><code>sample_period_start</code></td> <td>DateTime</td> <td>Start of data period used (nullable)</td> </tr> <tr> <td><code>sample_period_end</code></td> <td>DateTime</td> <td>End of data period used (nullable)</td> </tr> <tr> <td><code>calculation_method</code></td> <td>String</td> <td>Method used (e.g., "interval_analysis", nullable)</td> </tr> <tr> <td><code>last_updated</code></td> <td>DateTime</td> <td>Last update timestamp</td> </tr> </tbody> </table> <p><strong>Indexes</strong>:</p> <ul> <li><code>idx_priors_entry</code> on <code>entry_id</code>: Fast filtering by integration</li> <li><code>idx_priors_area</code> on <code>area_name</code>: Fast filtering by area</li> <li><code>idx_priors_entry_area</code> on <code>(entry_id, area_name)</code>: Composite index for area queries</li> <li><code>idx_priors_day_slot</code> on <code>(day_of_week, time_slot)</code>: Fast lookup by time slot</li> <li><code>idx_priors_last_updated</code> on <code>last_updated</code>: For tracking recalculations</li> </ul> <p><strong>Relationships</strong>:</p> <ul> <li>Many-to-one with <code>areas</code> table via <code>area_name</code> foreign key</li> </ul> <h3 id=32-storage-operations>3.2 Storage Operations<a class=headerlink href=#32-storage-operations title="Permanent link">&para;</a></h3> <p><strong>Location</strong>: <code>db/operations.py:save_time_priors()</code> (line 1000)</p> <p><strong>Function Signature</strong>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>def</span><span class=w> </span><span class=nf>save_time_priors</span><span class=p>(</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=n>db</span><span class=p>:</span> <span class=n>AreaOccupancyDB</span><span class=p>,</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    <span class=n>area_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>    <span class=n>time_priors</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>],</span> <span class=nb>float</span><span class=p>],</span>  <span class=c1># (day_of_week, time_slot) -&gt; prior_value</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>    <span class=n>data_period_start</span><span class=p>:</span> <span class=n>datetime</span><span class=p>,</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>    <span class=n>data_period_end</span><span class=p>:</span> <span class=n>datetime</span><span class=p>,</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>    <span class=n>data_points_per_slot</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>],</span> <span class=nb>int</span><span class=p>],</span>  <span class=c1># (day_of_week, time_slot) -&gt; weeks</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>    <span class=n>calculation_method</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;interval_analysis&quot;</span><span class=p>,</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></code></pre></div> <p><strong>Implementation Details</strong>:</p> <ul> <li>Processes all time priors in a single database transaction</li> <li>For each slot, checks if a record exists:</li> <li><strong>If exists</strong>: Updates <code>prior_value</code>, <code>data_points</code>, <code>confidence</code>, <code>last_calculation_date</code>, <code>sample_period_start/end</code>, <code>calculation_method</code></li> <li><strong>If new</strong>: Creates a new <code>Priors</code> record with all fields populated</li> <li>Calculates confidence as <code>min(1.0, data_points / 4.0)</code> where 4 weeks = full confidence</li> <li>Uses bulk operations for efficiency</li> <li>Returns <code>True</code> on success, <code>False</code> on error</li> <li>Logs debug information about number of slots saved/updated</li> </ul> <h2 id=retrieval-at-runtime>Retrieval at Runtime<a class=headerlink href=#retrieval-at-runtime title="Permanent link">&para;</a></h2> <h3 id=41-retrieval-flow>4.1 Retrieval Flow<a class=headerlink href=#41-retrieval-flow title="Permanent link">&para;</a></h3> <p>The time prior retrieval follows this path:</p> <ol> <li><strong>Entry Point</strong>: <code>prior.py:Prior.time_prior</code> property (line 115)</li> <li>Called when calculating combined prior</li> <li> <p>Property getter that triggers retrieval if needed</p> </li> <li> <p><strong>Cache Check</strong>: Checks if <code>_cached_time_priors</code> dictionary is populated (line 118)</p> </li> <li>If <code>None</code>, triggers <code>_load_time_priors()</code> to load all 168 slots from database</li> <li> <p>Cache stores all time priors as a dictionary: <code>(day_of_week, time_slot) -&gt; prior_value</code></p> </li> <li> <p><strong>Load All Time Priors</strong>: <code>prior.py:_load_time_priors()</code> (line 161)</p> </li> <li>Calls <code>db.get_all_time_priors()</code> to retrieve all time priors for the area</li> <li>Loads all 168 slots in a single database query for efficiency</li> <li>Applies safety bounds [0.1, 0.9] to all values during loading</li> <li> <p>Falls back to default values if database query fails</p> </li> <li> <p><strong>Database Method</strong>: <code>db/core.py:get_all_time_priors()</code> (line 304)</p> </li> <li>Wrapper that adds <code>entry_id</code> parameter</li> <li> <p>Calls query function</p> </li> <li> <p><strong>Query Function</strong>: <code>queries.py:get_all_time_priors()</code> (line 111)</p> </li> <li>Queries <code>Priors</code> table filtered by:<ul> <li><code>entry_id</code>: Integration entry ID</li> <li><code>area_name</code>: Area name</li> </ul> </li> <li>Returns dictionary mapping <code>(day_of_week, time_slot)</code> to <code>prior_value</code></li> <li> <p>Fills in missing slots with <code>default_prior</code> (0.5) to ensure all 168 slots are present</p> </li> <li> <p><strong>Get Current Slot</strong>: After cache is loaded, retrieves value for current day/slot (line 121-126)</p> </li> <li>Gets current <code>day_of_week</code> and <code>time_slot</code></li> <li>Looks up value in cached dictionary</li> <li> <p>Returns <code>DEFAULT_TIME_PRIOR</code> (0.5) if slot not found (shouldn't happen after <code>get_all_time_priors()</code>)</p> </li> <li> <p><strong>Safety Bounds</strong>: Applied during <code>_load_time_priors()</code> (line 173-177)</p> </li> <li>Clamps all values to [TIME_PRIOR_MIN_BOUND, TIME_PRIOR_MAX_BOUND] = [0.1, 0.9]</li> <li>Prevents extreme values from affecting calculations</li> </ol> <h3 id=42-time-slot-calculation>4.2 Time Slot Calculation<a class=headerlink href=#42-time-slot-calculation title="Permanent link">&para;</a></h3> <p><strong>Day of Week</strong>: <code>prior.py:day_of_week</code> property (line 156)</p> <ul> <li>Uses <code>dt_util.utcnow().weekday()</code></li> <li>Returns 0=Monday, 1=Tuesday, ..., 6=Sunday</li> </ul> <p><strong>Time Slot</strong>: <code>prior.py:time_slot</code> property (line 161)</p> <ul> <li>Calculates: <code>(now.hour * 60 + now.minute) // DEFAULT_SLOT_MINUTES</code></li> <li><code>DEFAULT_SLOT_MINUTES = 60</code> (line 39)</li> <li>Returns 0-23 for hourly slots</li> </ul> <p><strong>Example</strong>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># Monday at 14:30</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>day_of_week</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># Monday</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=n>time_slot</span> <span class=o>=</span> <span class=p>(</span><span class=mi>14</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>+</span> <span class=mi>30</span><span class=p>)</span> <span class=o>//</span> <span class=mi>60</span> <span class=o>=</span> <span class=mi>14</span>  <span class=c1># 14:00-15:00 slot</span>
</span></code></pre></div> <h3 id=43-caching-strategy>4.3 Caching Strategy<a class=headerlink href=#43-caching-strategy title="Permanent link">&para;</a></h3> <p><strong>Cache Structure</strong>: <code>_cached_time_priors</code> dictionary</p> <ul> <li>Stores all 168 time priors: <code>dict[tuple[int, int], float]</code></li> <li>Key: <code>(day_of_week, time_slot)</code> tuple</li> <li>Value: <code>prior_value</code> (already clamped to [0.1, 0.9])</li> <li>Loaded once per <code>Prior</code> instance lifecycle</li> </ul> <p><strong>Cache Population</strong>:</p> <ul> <li>Loaded lazily on first access to <code>time_prior</code> property</li> <li>Loads all 168 slots in a single database query for efficiency</li> <li>Applied safety bounds during loading</li> </ul> <p><strong>Cache Invalidation</strong>: <code>_invalidate_time_prior_cache()</code> (line 157)</p> <ul> <li>Called when global prior changes (<code>set_global_prior()</code>)</li> <li>Sets <code>_cached_time_priors = None</code> to force reload on next access</li> <li>Also called by <code>clear_cache()</code> method</li> </ul> <p><strong>TTL</strong>: No time-based expiration</p> <ul> <li>Cache persists until invalidated (when global prior changes)</li> <li>Since all 168 slots are cached, no need to check day/slot on each access</li> <li>Simply looks up current slot in the cached dictionary</li> </ul> <p><strong>Rationale</strong>: Loading all time priors at once is more efficient than individual queries. Time priors don't change frequently (only during analysis cycles), so caching all slots is safe and provides fast access.</p> <h2 id=usage-in-probability-calculation>Usage in Probability Calculation<a class=headerlink href=#usage-in-probability-calculation title="Permanent link">&para;</a></h2> <h3 id=51-prior-combination>5.1 Prior Combination<a class=headerlink href=#51-prior-combination title="Permanent link">&para;</a></h3> <p><strong>Location</strong>: <code>utils.py:combine_priors()</code> (line 329)</p> <p><strong>Method</strong>: Weighted averaging in logit space</p> <p><strong>Default Weight</strong>: <code>time_weight=0.2</code> (20% time prior, 80% global prior)</p> <p><strong>Process</strong>:</p> <ol> <li>Handle edge cases (time_weight == 0.0 or 1.0)</li> <li>Handle extreme values (0.0 or 1.0) by converting to MIN/MAX_PROBABILITY</li> <li>Convert both priors to logit space: <code>logit(p) = log(p / (1-p))</code></li> <li>Calculate weighted average: <code>combined_logit = area_weight * area_logit + time_weight * time_logit</code></li> <li><code>area_weight = 1.0 - time_weight</code></li> <li>Convert back to probability: <code>combined_prior = 1 / (1 + exp(-combined_logit))</code></li> <li>Clamp to valid range [MIN_PROBABILITY, MAX_PROBABILITY]</li> </ol> <p><strong>Why Logit Space?</strong></p> <ul> <li>Logit space provides better interpolation for probabilities</li> <li>Prevents issues with extreme values</li> <li>More mathematically principled than linear interpolation</li> </ul> <p><strong>Example</strong>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>area_prior</span> <span class=o>=</span> <span class=mf>0.3</span>  <span class=c1># 30% occupancy overall</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>time_prior</span> <span class=o>=</span> <span class=mf>0.7</span>  <span class=c1># 70% occupancy for this time slot</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=n>time_weight</span> <span class=o>=</span> <span class=mf>0.2</span>  <span class=c1># 20% weight to time prior</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=c1># Convert to logit space</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=n>area_logit</span> <span class=o>=</span> <span class=n>log</span><span class=p>(</span><span class=mf>0.3</span> <span class=o>/</span> <span class=mf>0.7</span><span class=p>)</span> <span class=err>≈</span> <span class=o>-</span><span class=mf>0.847</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=n>time_logit</span> <span class=o>=</span> <span class=n>log</span><span class=p>(</span><span class=mf>0.7</span> <span class=o>/</span> <span class=mf>0.3</span><span class=p>)</span> <span class=err>≈</span> <span class=mf>0.847</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=c1># Weighted average</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=n>combined_logit</span> <span class=o>=</span> <span class=mf>0.8</span> <span class=o>*</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.847</span><span class=p>)</span> <span class=o>+</span> <span class=mf>0.2</span> <span class=o>*</span> <span class=mf>0.847</span> <span class=err>≈</span> <span class=o>-</span><span class=mf>0.508</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=c1># Convert back</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=n>combined_prior</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>exp</span><span class=p>(</span><span class=mf>0.508</span><span class=p>))</span> <span class=err>≈</span> <span class=mf>0.375</span>
</span></code></pre></div> <h3 id=52-integration-point>5.2 Integration Point<a class=headerlink href=#52-integration-point title="Permanent link">&para;</a></h3> <p><strong>Location</strong>: <code>prior.py:Prior.value</code> property (line 82)</p> <p><strong>Flow</strong>:</p> <ol> <li>Gets <code>global_prior</code> from memory (<code>self.global_prior</code>)</li> <li>Gets <code>time_prior</code> via property (triggers retrieval if needed)</li> <li>Combines using <code>combine_priors()</code> if both exist:</li> <li>If <code>time_prior</code> is <code>None</code>, uses <code>global_prior</code> directly</li> <li>Otherwise combines: <code>combine_priors(global_prior, time_prior)</code></li> <li>Applies <code>PRIOR_FACTOR</code> (1.05) multiplier</li> <li>Slight bias towards occupancy ("better safe than sorry")</li> <li>Applies <code>min_prior_override</code> if configured</li> <li>Ensures minimum prior doesn't drop too low</li> </ol> <p><strong>Code Flow</strong>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nd>@property</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>def</span><span class=w> </span><span class=nf>value</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>global_prior</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>MIN_PRIOR</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>time_prior</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>            <span class=n>prior</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>global_prior</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>            <span class=n>prior</span> <span class=o>=</span> <span class=n>combine_priors</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>global_prior</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>time_prior</span><span class=p>)</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>        <span class=c1># Apply factor and clamping</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>        <span class=n>adjusted_prior</span> <span class=o>=</span> <span class=n>prior</span> <span class=o>*</span> <span class=n>PRIOR_FACTOR</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>        <span class=n>result</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>MIN_PRIOR</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=n>MAX_PRIOR</span><span class=p>,</span> <span class=n>adjusted_prior</span><span class=p>))</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>    <span class=c1># Apply minimum override</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>min_prior_override</span> <span class=o>&gt;</span> <span class=mf>0.0</span><span class=p>:</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>        <span class=n>result</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>min_prior_override</span><span class=p>)</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>    <span class=k>return</span> <span class=n>result</span>
</span></code></pre></div> <h2 id=code-flow-diagrams>Code Flow Diagrams<a class=headerlink href=#code-flow-diagrams title="Permanent link">&para;</a></h2> <h3 id=61-time-prior-retrieval-sequence>6.1 Time Prior Retrieval Sequence<a class=headerlink href=#61-time-prior-retrieval-sequence title="Permanent link">&para;</a></h3> <pre class=mermaid><code>sequenceDiagram
    participant Area as Area Object
    participant Prior as Prior Object
    participant Cache as Cache Dict
    participant DB as Database
    participant Query as Query Function

    Area-&gt;&gt;Prior: probability() calculation
    Prior-&gt;&gt;Prior: value property
    Prior-&gt;&gt;Prior: time_prior property
    Prior-&gt;&gt;Cache: Check if _cached_time_priors is None

    alt Cache Populated
        Cache--&gt;&gt;Prior: Dictionary with all 168 slots
        Prior-&gt;&gt;Prior: Get current (day, slot)
        Prior-&gt;&gt;Cache: Lookup (day, slot)
        Cache--&gt;&gt;Prior: prior_value for current slot
    else Cache Empty (First Access)
        Prior-&gt;&gt;Prior: _load_time_priors()
        Prior-&gt;&gt;DB: get_all_time_priors(area_name)
        DB-&gt;&gt;Query: get_all_time_priors(entry_id, area_name)
        Query-&gt;&gt;Query: Query all Priors for area
        Query--&gt;&gt;DB: Dictionary of all 168 slots
        DB--&gt;&gt;Prior: Dictionary of all slots
        Prior-&gt;&gt;Prior: Apply safety bounds [0.1, 0.9]
        Prior-&gt;&gt;Cache: Store all 168 slots
        Prior-&gt;&gt;Prior: Get current (day, slot)
        Prior-&gt;&gt;Cache: Lookup (day, slot)
        Cache--&gt;&gt;Prior: prior_value for current slot
    end

    Prior-&gt;&gt;Prior: combine_priors(global, time)
    Prior--&gt;&gt;Area: Combined prior</code></pre> <h3 id=62-time-prior-calculation-flow-when-implemented>6.2 Time Prior Calculation Flow (When Implemented)<a class=headerlink href=#62-time-prior-calculation-flow-when-implemented title="Permanent link">&para;</a></h3> <pre class=mermaid><code>flowchart TD
    Start([Analysis Cycle]) --&gt; GetIntervals[Get Occupied Intervals]
    GetIntervals --&gt; GroupSlots[Group by Day/Slot]
    GroupSlots --&gt; ForEachSlot{For Each Slot&lt;br/&gt;168 total}

    ForEachSlot --&gt; CalcOccupied[Calculate Occupied Seconds]
    CalcOccupied --&gt; CalcTotal[Calculate Total Slot Seconds]
    CalcTotal --&gt; CalcPercent[Calculate Percentage]
    CalcPercent --&gt; ApplyBounds[Apply Safety Bounds&lt;br/&gt;[0.1, 0.9]]
    ApplyBounds --&gt; StorePrior[Store in Priors Table]

    StorePrior --&gt; MoreSlots{More Slots?}
    MoreSlots --&gt;|Yes| ForEachSlot
    MoreSlots --&gt;|No| Complete([Calculation Complete])</code></pre> <h3 id=63-complete-prior-calculation-flow>6.3 Complete Prior Calculation Flow<a class=headerlink href=#63-complete-prior-calculation-flow title="Permanent link">&para;</a></h3> <pre class=mermaid><code>flowchart TD
    Start([Prior Calculation]) --&gt; GetIntervals[Get Occupied Intervals&lt;br/&gt;from Motion Sensors]
    GetIntervals --&gt; CalcGlobal[Calculate Global Prior]
    CalcGlobal --&gt; SaveGlobal[Save to GlobalPriors Table]

    SaveGlobal --&gt; CalcTime[Calculate Time Priors]
    CalcTime --&gt; GroupSlots[Group Intervals by&lt;br/&gt;Day of Week &amp; Time Slot]
    GroupSlots --&gt; CalcSlots[Calculate Prior per Slot]
    CalcSlots --&gt; SaveTime[Save to Priors Table]

    SaveTime --&gt; Complete([Prior Calculation Complete])</code></pre> <h2 id=implementation-notes>Implementation Notes<a class=headerlink href=#implementation-notes title="Permanent link">&para;</a></h2> <h3 id=71-cache-invalidation-logic>7.1 Cache Invalidation Logic<a class=headerlink href=#71-cache-invalidation-logic title="Permanent link">&para;</a></h3> <p><strong>Issue</strong>: Cache only invalidated when global prior changes, not on time slot change</p> <p><strong>Impact</strong>: Cache persists across time slots if global prior unchanged</p> <p><strong>Current Behavior</strong>: Cache checked against current day/slot on each access, so cache is automatically refreshed when day/slot changes</p> <p><strong>Analysis</strong>: This is actually correct behavior - the cache check ensures we always get the right value for the current time slot, even if the global prior hasn't changed.</p> <p><strong>Recommendation</strong>: No change needed - current implementation is correct</p> <h3 id=73-default-value-handling>7.3 Default Value Handling<a class=headerlink href=#73-default-value-handling title="Permanent link">&para;</a></h3> <p><strong>Issue</strong>: Missing time priors return <code>DEFAULT_TIME_PRIOR</code> (0.5) without metadata</p> <p><strong>Impact</strong>: No way to distinguish "no data" from "50% occupancy"</p> <p><strong>Current Behavior</strong>: Returns 0.5 for missing slots, which is reasonable default</p> <p><strong>Recommendation</strong>: Consider adding metadata flag or logging when default is used, but current behavior is acceptable</p> <h3 id=74-time-slot-granularity>7.4 Time Slot Granularity<a class=headerlink href=#74-time-slot-granularity title="Permanent link">&para;</a></h3> <p><strong>Issue</strong>: Fixed 60-minute slots may not match user schedules</p> <p><strong>Impact</strong>: Less granular than ideal for precise time-based learning</p> <p><strong>Current Behavior</strong>: 1-hour slots (24 slots per day × 7 days = 168 slots)</p> <p><strong>Recommendation</strong>: Consider configurable slot duration in future, but 1-hour slots are reasonable default</p> <h3 id=75-data-period-tracking>7.5 Data Period Tracking<a class=headerlink href=#75-data-period-tracking title="Permanent link">&para;</a></h3> <p><strong>Status</strong>: <code>sample_period_start/end</code> fields are populated by <code>save_time_priors()</code> function</p> <p><strong>Implementation</strong>: The calculation function passes the data period used for analysis, which is stored in the database for tracking and verification purposes.</p> <h2 id=related-documentation>Related Documentation<a class=headerlink href=#related-documentation title="Permanent link">&para;</a></h2> <ul> <li><a href=../database-schema/ >Database Schema</a> - Complete database schema documentation</li> <li><a href=../../features/prior-learning/ >Prior Learning</a> - User-facing prior learning documentation</li> <li><a href=../data-flow/ >Data Flow</a> - Overall data flow diagrams</li> <li><a href=../bayesian-calculation/ >Bayesian Calculation</a> - How priors are used in calculations</li> </ul> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../global-prior-flow/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Global Prior Flow"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Global Prior Flow </div> </div> </a> <a href=../entity-evidence/ class="md-footer__link md-footer__link--next" aria-label="Next: Entity Evidence"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Entity Evidence </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/Hankanman/Area-Occupancy-Detection target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tracking", "navigation.top", "navigation.footer", "search.highlight", "search.share", "search.suggest", "content.code.copy", "content.code.annotate", "content.tabs.link", "content.action.edit", "content.action.view", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../javascript/mathjax.js></script> <script src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>